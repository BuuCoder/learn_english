<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>English Teacher AI</title>
    <link href="https://fonts.googleapis.com/css2?family=Google+Sans:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/main.css') }}">

    <!-- PWA settings -->
    <link rel="manifest" href="{{ url_for('static', filename='manifest.json') }}">
    <meta name="theme-color" content="#ffffff">
    <link rel="icon" type="image/png" sizes="32x32" href="{{ url_for('static', filename='images/logo-32.png') }}">
    <link rel="icon" type="image/png" sizes="16x16" href="{{ url_for('static', filename='images/logo-16.png') }}">
    <link rel="apple-touch-icon" href="{{ url_for('static', filename='images/logo.png') }}">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
</head>

<body>
    <!-- Sidebar -->
    <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <button class="btn-menu" onclick="toggleSidebar()">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z" />
                </svg>
            </button>
            <span class="logo">Teacher Da Vinci</span>
        </div>

        <button class="btn-new-chat" onclick="createNewConversation()">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M12 5v14M5 12h14" />
            </svg>
            Cu·ªôc tr√≤ chuy·ªán m·ªõi
        </button>

        <div class="sidebar-section">Cu·ªôc tr√≤ chuy·ªán</div>
        <div class="conversation-list" id="conversationList"></div>

        <!-- Sidebar User Section -->
        <div class="sidebar-user-section">
            <!-- Full info for mobile -->
            <div class="sidebar-user-full">
                <div class="sidebar-user-info">
                    <div class="sidebar-user-avatar">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                            <path
                                d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z" />
                        </svg>
                    </div>
                    <div class="sidebar-user-details">
                        <span class="sidebar-user-name" id="sidebarUserName">Ng∆∞·ªùi d√πng</span>
                        <span class="sidebar-user-email" id="sidebarUserEmail">user@example.com</span>
                    </div>
                </div>
                <div class="sidebar-token-usage">
                    <div class="token-progress-bar">
                        <div class="token-progress" id="tokenProgress"></div>
                    </div>
                    <span class="token-text" id="sidebarTokenText">Usage: 0 / 100,000 credits</span>
                </div>
                <div class="sidebar-user-actions">
                    <button class="sidebar-action-btn" onclick="openAccount()">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <circle cx="12" cy="12" r="3" />
                            <path
                                d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z" />
                        </svg>
                        C√†i ƒë·∫∑t
                    </button>
                    <button class="sidebar-action-btn logout" onclick="logout()">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4" />
                            <polyline points="16 17 21 12 16 7" />
                            <line x1="21" y1="12" x2="9" y2="12" />
                        </svg>
                        ƒêƒÉng xu·∫•t
                    </button>
                </div>
            </div>
            <!-- Simple token count for desktop -->
            <div class="sidebar-token-simple">
                <span class="token-value" id="sidebarTokenSimple">Usage: 0 / 100,000 credits</span>
            </div>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="main-content" id="mainContent">
        <div class="top-bar">
            <button class="btn-toggle-sidebar" onclick="toggleSidebar()">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z" />
                </svg>
            </button>

            <div class="header-spacer"></div>

            <!-- Header Actions Group -->
            <div class="header-actions">
                <!-- Vocabulary Button -->
                <button class="header-action-btn" onclick="toggleVocabPanel()" title="T·ª´ v·ª±ng ƒë√£ l∆∞u">
                    <div class="action-icon vocab-icon">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#34a853" stroke-width="2">
                            <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20" />
                            <path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z" />
                        </svg>
                    </div>
                </button>

                <!-- Divider -->
                <div class="header-divider"></div>

                <!-- Voice Selector -->
                <div class="voice-selector" id="voiceSelector">
                    <button class="header-action-btn" onclick="toggleVoiceMenu()" title="Ch·ªçn gi·ªçng ƒë·ªçc">
                        <div class="action-icon voice-icon">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="#f9ab00">
                                <path
                                    d="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3z" />
                                <path
                                    d="M17 11c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.53 2.61 6.43 6 6.92V21h2v-3.08c3.39-.49 6-3.39 6-6.92h-2z" />
                            </svg>
                        </div>
                    </button>
                    <div class="voice-menu" id="voiceMenu">
                        <div class="voice-section">
                            <div class="voice-label">Gi·ªçng Ti·∫øng Vi·ªát</div>
                            <select id="voiceVi" class="voice-select" onchange="updateVoice()"></select>
                        </div>
                        <div class="voice-section">
                            <div class="voice-label">Gi·ªçng Ti·∫øng Anh</div>
                            <select id="voiceEn" class="voice-select" onchange="updateVoice()"></select>
                        </div>
                    </div>
                </div>

                <!-- Divider -->
                <div class="header-divider"></div>

                <!-- User Profile -->
                <div class="user-profile" id="userProfile">
                    <button class="header-action-btn user-btn" onclick="toggleUserMenu()">
                        <div class="action-icon user-icon">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                                <path
                                    d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z" />
                            </svg>
                        </div>
                    </button>
                    <div class="user-menu" id="userMenu">
                        <div class="user-menu-header">
                            <span class="user-email-top" id="userEmailTop">user@example.com</span>
                            <button class="btn-close-menu" onclick="toggleUserMenu()">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2">
                                    <line x1="18" y1="6" x2="6" y2="18" />
                                    <line x1="6" y1="6" x2="18" y2="18" />
                                </svg>
                            </button>
                        </div>
                        <div class="user-info">
                            <div class="user-avatar-large">
                                <svg width="40" height="40" viewBox="0 0 24 24" fill="currentColor">
                                    <path
                                        d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z" />
                                </svg>
                            </div>
                            <div class="user-greeting">Ch√†o <span id="userName">Ng∆∞·ªùi d√πng</span>,</div>
                            <span class="user-email" id="userEmail" style="display:none;">user@example.com</span>
                        </div>
                        <div class="user-actions">
                            <button class="btn-action" onclick="openAccount()">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2">
                                    <circle cx="12" cy="12" r="3" />
                                    <path
                                        d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z" />
                                </svg>
                                T√†i kho·∫£n
                            </button>
                            <button class="btn-action logout" onclick="logout()">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2">
                                    <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4" />
                                    <polyline points="16 17 21 12 16 7" />
                                    <line x1="21" y1="12" x2="9" y2="12" />
                                </svg>
                                ƒêƒÉng xu·∫•t
                            </button>
                        </div>
                        <div class="token-usage-section">
                            <div class="token-usage-icon">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                                    <path
                                        d="M19.35 10.04C18.67 6.59 15.64 4 12 4 9.11 4 6.6 5.64 5.35 8.04 2.34 8.36 0 10.91 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96z" />
                                </svg>
                            </div>
                            <span class="token-usage-text" id="tokenUsageText">ƒê√£ d√πng 0% trong 100K token</span>
                        </div>
                    </div>
                </div>
            </div><!-- End header-actions -->
        </div>

        <div class="container">
            <div class="welcome-section" id="welcomeSection">
                <div class="welcome-title">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                        <path
                            d="M12 2L15.09 8.26L22 9.27L17 14.14L18.18 21.02L12 17.77L5.82 21.02L7 14.14L2 9.27L8.91 8.26L12 2Z"
                            fill="url(#starGradient)" />
                        <defs>
                            <linearGradient id="starGradient" x1="2" y1="2" x2="22" y2="22">
                                <stop offset="0%" stop-color="#4285f4" />
                                <stop offset="50%" stop-color="#34a853" />
                                <stop offset="100%" stop-color="#fbbc05" />
                            </linearGradient>
                        </defs>
                    </svg>
                    <span style="color: #4285f4; font-weight: 500;">Xin ch√†o!</span>
                </div>
                <h1 class="main-question">Ch√∫ng ta n√™n b·∫Øt ƒë·∫ßu t·ª´ ƒë√¢u nh·ªâ?</h1>
            </div>

            <div class="chat-messages" id="chatMessages"></div>

            <div class="controls"></div>
        </div>

        <!-- Fixed Input Section -->
        <div class="input-section" id="inputSection">
            <div class="input-wrapper">
                <div class="input-box">
                    <!-- Additional options button -->
                    <div class="input-options">
                        <button class="btn-options" id="optionsBtn" onclick="toggleOptionsMenu()" title="T√πy ch·ªçn">
                            <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2">
                                <line x1="12" y1="5" x2="12" y2="19" />
                                <line x1="5" y1="12" x2="19" y2="12" />
                            </svg>
                        </button>
                        <div class="options-menu" id="optionsMenu">
                            <div class="options-menu-item" onclick="toggleAutoPlay()">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2">
                                    <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5" />
                                    <path d="M15.54 8.46a5 5 0 0 1 0 7.07" />
                                    <path d="M19.07 4.93a10 10 0 0 1 0 14.14" />
                                </svg>
                                <span>T·ª± ƒë·ªông ph√°t khi tr·∫£ l·ªùi</span>
                                <div class="toggle-switch" id="autoPlayToggle">
                                    <div class="toggle-slider"></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <textarea id="messageInput" placeholder="H·ªèi Teacher Da Vinci..." rows="1"></textarea>
                    <div class="input-actions">
                        <!-- Clear text button (hidden by default) -->
                        <button class="btn-clear-text" id="clearTextBtn" onclick="clearMessageText()" title="X√≥a"
                            style="display: none;">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2.5">
                                <line x1="18" y1="6" x2="6" y2="18" />
                                <line x1="6" y1="6" x2="18" y2="18" />
                            </svg>
                        </button>
                        <!-- Mic button -->
                        <button class="btn-mic" id="micBtn" title="Nh·∫•n ƒë·ªÉ n√≥i">
                            <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2">
                                <rect x="9" y="2" width="6" height="11" rx="3" />
                                <path d="M19 10v1a7 7 0 0 1-14 0v-1" />
                                <line x1="12" y1="19" x2="12" y2="22" />
                            </svg>
                        </button>
                        <!-- Send button -->
                        <button class="btn-send" id="sendBtn" onclick="sendMessage()" title="G·ª≠i">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2.5">
                                <line x1="12" y1="19" x2="12" y2="5" />
                                <polyline points="5 12 12 5 19 12" />
                            </svg>
                        </button>
                    </div>
                </div>

                <div class="quick-actions">
                    <button class="quick-btn" onclick="sendQuickMessage('D·∫°y t√¥i c√°ch ch√†o h·ªèi')">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <path d="M18 8a6 6 0 0 0-12 0c0 7-3 9-3 9h18s-3-2-3-9" />
                            <path d="M13.73 21a2 2 0 0 1-3.46 0" />
                        </svg>
                        C√°ch ch√†o h·ªèi
                    </button>
                    <button class="quick-btn" onclick="sendQuickMessage('Luy·ªán ph√°t √¢m')">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3z" />
                            <path
                                d="M17 11c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.53 2.61 6.43 6 6.92V21h2v-3.08c3.39-.49 6-3.39 6-6.92h-2z" />
                        </svg>
                        Luy·ªán ph√°t √¢m
                    </button>
                    <button class="quick-btn" onclick="sendQuickMessage('H·ªçc t·ª´ v·ª±ng m·ªõi')">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20" />
                            <path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z" />
                        </svg>
                        H·ªçc t·ª´ v·ª±ng
                    </button>
                    <button class="quick-btn" onclick="sendQuickMessage('S·ª≠a l·ªói ng·ªØ ph√°p')">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <path d="M12 20h9" />
                            <path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z" />
                        </svg>
                        S·ª≠a ng·ªØ ph√°p
                    </button>
                </div>
            </div>
        </div>
    </main>

    <!-- Vocabulary Save Popup -->
    <div class="vocab-popup" id="vocabPopup">
        <button class="btn-save-vocab" onclick="saveSelectedVocab()">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z" />
                <polyline points="17 21 17 13 7 13 7 21" />
                <polyline points="7 3 7 8 15 8" />
            </svg>
            L∆∞u t·ª´
        </button>
        <button class="btn-cancel" onclick="hideVocabPopup()">‚úï</button>
    </div>

    <!-- Vocabulary Panel -->
    <div class="vocab-panel" id="vocabPanel">
        <div class="vocab-panel-header">
            <h3>üìö T·ª´ v·ª±ng ƒë√£ l∆∞u</h3>
            <button class="btn-close" onclick="toggleVocabPanel()">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="18" y1="6" x2="6" y2="18" />
                    <line x1="6" y1="6" x2="18" y2="18" />
                </svg>
            </button>
        </div>
        <div class="vocab-search">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="11" cy="11" r="8" />
                <path d="M21 21l-4.35-4.35" />
            </svg>
            <input type="text" id="vocabSearchInput" placeholder="T√¨m t·ª´ v·ª±ng..." oninput="filterVocabularies()">
        </div>
        <div class="vocab-list" id="vocabList">
            <div class="vocab-empty">Ch∆∞a c√≥ t·ª´ v·ª±ng n√†o ƒë∆∞·ª£c l∆∞u</div>
        </div>
    </div>

    <!-- Voice Menu Overlay (mobile) -->
    <div class="voice-menu-overlay" id="voiceMenuOverlay" onclick="closeVoiceMenu()"></div>

    <!-- Sidebar Overlay (mobile) -->
    <div class="sidebar-overlay" id="sidebarOverlay" onclick="closeSidebar()"></div>

    <script src="{{ url_for('static', filename='js/app.js') }}"></script>
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register("{{ url_for('static', filename='sw.js') }}")
                    .then(reg => console.log('SW registered'))
                    .catch(err => console.log('SW registration failed', err));
            });
        }
    </script>
</body>

</html>